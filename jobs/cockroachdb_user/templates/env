#!/bin/bash

export CONF_DIR=/var/vcap/jobs/cockroachdb_user/config

chmod 600 $CONF_DIR/cert_ca $CONF_DIR/cert $CONF_DIR/cert_private_key

# Use env vars since some command dont allow these flags
export COCKROACH_CA_CERT=$CONF_DIR/cert_ca
export COCKROACH_CERT=$CONF_DIR/cert
export COCKROACH_KEY=$CONF_DIR/cert_private_key

# todo what if first instance is not available?
export COCKROACH_HOST=<%= link("conn").instances.first.address %>
export COCKROACH_PORT=<%= link("conn").p("port") %>

alias cockroach=/var/vcap/packages/cockroachdb/cockroach
